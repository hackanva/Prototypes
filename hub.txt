(* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
My VERSION with OCR Implementation
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *)

// Step 1: Log into Agility
DoubleClick "Chrome/GoogleChrome"
Click {Image:"vawwinsidervagov", WaitFor:4}
TypeText "https://www1.dfrhost.com/va-fsc-gov/Default.aspx?menu=RegressionTestPage", Return
Click {Image:"PIVSignIn_002", WaitFor:20}
Click {Image:"CertificateOKButton_002", WaitFor:10}

// Handle different scenarios after attempting to log in with PIV card

// Scenario 1: PIN entry is requested
if ImageFound("PINEntry_002", WaitFor: 10) then
    Click {Image:"PINEntry_002", WaitFor:4}
    TypeText "270607", Return
    log "PIN entry completed successfully."

// Scenario 2: Directly authenticated without PIN prompt
else if ImageFound("AgilityHomePage", WaitFor: 10) then
    log "Authenticated successfully without a PIN prompt."

// Scenario 3: Long authentication wait with additional security prompts
else if ImageFound("Authenticating", WaitFor: 240) then // Wait up to 4 minutes
    log "Authenticating... please wait."
    if ImageFound("PIVPrompt", WaitFor: 10) then
        Click "PIVPromptOKButton"
        log "PIV prompt confirmed."
        if ImageFound("AdditionalSecurityPrompt", WaitFor: 10) then
            Click "AdditionalSecurityOKButton"
            log "Additional security prompt confirmed."
        else
            log "No additional security prompt detected. Continuing..."
        end if
    else
        log "No further prompts after authenticating. Proceeding..."
    end if

// Step 4: Verification using JavaScript and Class Selector

// JavaScript ile belirli bir class içindeki metin değerini alın
put remoteConnection's doJavaScript("return document.querySelector('[data-id=\"Story_Custom_DefinitionOfDoneBacklog\"] .rich-text-content').innerText") into acceptanceCriteriaText

// "Acceptance Criteria" alanının boş olup olmadığını kontrol edin
if acceptanceCriteriaText is not empty then
    log "Acceptance Criteria text is present: " & acceptanceCriteriaText
else
    log "Acceptance Criteria text is missing or empty."
end if

// Unexpected scenario
else
    logError "Unexpected authentication behavior detected. Exiting script."
    exit all
end if

// Step 2: Inside Agility - Perform actions after successful login
WaitFor 10, "SearchIcon"
Click Image:"SearchIcon"
TypeText "S-124488", Return
Click Image:"StorySearchResult"

// Set imagefound location to status
Set the assertionBehavior to "Warning"
Assert that ImageFound(Image:"StatusAccepted", WaitFor: 10) or ImageFound(Image:"StatusDone", WaitFor: 10)

// Step 3: User Story Title Verification using OCR
// Correct usage with an image property or predefined area
put (100, 200, 350, 250) into myRect // Define a rectangle area where the text is expected
put ReadText(myRect, Contrast: "High") into userStoryTitleText
if userStoryTitleText is not empty then
    log "User Story Title text (OCR): " & userStoryTitleText
else
    log "User Story Title text could not be retrieved using OCR."
end if

// Step 4: Definition of Done Verification using JavaScript

// JavaScript ile "Definition of Done" alanındaki değeri okuyun
put remoteConnection's doJavaScript("return document.getElementById('definitionOfDone').value") into def_done_text

// "Definition of Done" alanının boş olup olmadığını kontrol edin
if def_done_text is not empty then
    log "Definition of Done text is present: " & def_done_text
else
    log "Definition of Done text is missing or empty."
end if

// Step 5: Description Verification using OCR
put ReadText((Rectangle: (100, 400, 300, 50)), Contrast: "High") into DescriptionText
if DescriptionText is not empty then
    log "Description Text (OCR): " & DescriptionText
else
    log "Description text could not be retrieved using OCR."
end if

// Step 6: Acceptance Criteria Verification using OCR
put ReadText((Rectangle: (100, 500, 300, 50)), Contrast: "High") into AcceptanceCriteriaText
if AcceptanceCriteriaText is not empty then
    log "Acceptance Criteria Text (OCR): " & AcceptanceCriteriaText
else
    log "Acceptance Criteria text could not be retrieved using OCR."
end if



RegEx Solution:
put remoteConnection's doJavaScript("return document.querySelector('[class*=\"rich-text-content\"]').innerText;") into acceptanceCriteriaText


if acceptanceCriteriaText is not empty then
    log "Acceptance Criteria text is present: " & acceptanceCriteriaText

    
    if acceptanceCriteriaText matches regexPattern then
        log "The text matches the expected pattern."
    else
        log "The text does not match the expected pattern."
    end if
else
    log "Acceptance Criteria text is missing or empty."
end if



(*****NEW FUNCTIONS by Hakan Yorganci*****)
(*****New Functions for TBA14*****)

// Entering New Information for BMF Document Type (Created by Hakan on 08/27/24)
to newinformation_bmf documentTypeBMF, securityorgBMF
	Click "BMF_DocType"
	TypeText documentTypeBMF
	Click {Image:"BMF_SecOrg", WaitFor:10}
	Click BMF_SecOrg
	TypeText securityorgBMF
	Click "BMF_GenerateDocNum"
	
	Click "BMF_Finish"
end newinformation_bmf

// Entering General Information on the Header Tab - BMF Document
to generalinfo_header_bmf titleBMF, vendorBMF, textcodeBMF, disbursingOfficeBMF, locationCodeBMF, descriptionBMF, extDescriptionBMF
	Click "BMF_General_Title"
	TypeText titleBMF	
	Click "BMF_Vendor_Code"
	TypeText vendorBMF
	repeat until ImageFound(ImageName: "BMF_TextCode") 
		ScrollWheelDown 14.0
	end repeat
	Click "BMF_TextCode"
	TypeText textcodeBMF
	Click "BMF_DisbursingOffice"
	TypeText disbursingOfficeBMF
	repeat until ImageFound(ImageName: "BMF_IntTrans") 
		ScrollWheelDown 4.0
	end repeat
	Click "BMF_BillType"
	Click "BMF_BillTypeOpt"
	Click "BMF_LocationCode"
	TypeText locationCodeBMF
	repeat until ImageFound(ImageName: "BMF_Description") 
		ScrollWheelDown 12.0
	end repeat
	Click "BMF_Description"
	TypeText descriptionBMF
	Click "BMF_ExtDescription"
	TypeText extDescriptionBMF
end generalinfo_header_bmf


// Opening & Adding Accounting Lines Tab (Accounting Lines Navigation)
to navigating_al
	Click "AccountingLines1"
	Click "Add"
end navigating_al


// Entering Information on the Accounting Lines Tab - BMF Document

// General Part
to bmf_accounting_line_general  transactionBMF, recievableBMF, startDateBMF, endDateBMF
	Click "CNL_AL_TransactionTyp"
	TypeText transactionBMF
	Click "BMF_RecievableType"
	TypeText recievableBMF
	Click "BMF_StartDate"
	TypeText startDateBMF
	Click "BMF_EndDate"
	TypeText endDateBMF
end bmf_accounting_line_general

// Line Amounts Part
to bmf_accounting_line_amounts initialAmountBMF
	repeat until ImageFound(ImageName: "BMF_InitialAmount") 
		ScrollWheelDown
	end repeat
	Click "BMF_InitialAmount"
	TypeText ControlKey, "a"
	TypeText initialAmountBMF
end bmf_accounting_line_amounts

// Additional Attributes Part
to bmf_accounting_line_attributes shortKeyBMF
	repeat until ImageFound(ImageName: "CNL_AdditionalAttribute_ShortKey") 
		ScrollWheelDown
	end repeat
	Click "CNL_AdditionalAttribute_ShortKey"
	TypeText shortKeyBMF
end bmf_accounting_line_attributes 

// Accounting Dimensions Part
to bmf_accounting_line_dimensions templateBMF, bbfyBMF, fundBMF, revenueBMF, betcBMF
	repeat until ImageFound(ImageName: "BMF_Template")
		ScrollWheelDown
	end repeat
	Click "BMF_Template"
	TypeText templateBMF
	repeat until ImageFound(ImageName: "CNL_BBFY")
		ScrollWheelDown
	end repeat
	Click "CNL_BBFY"
	TypeText bbfyBMF
	Click "CNL_AL_Fund"
	TypeText fundBMF
	repeat until ImageFound(ImageName: "BMF_Revenue")
		ScrollWheelDown
	end repeat
	Click "BMF_Revenue"
	TypeText revenueBMF
	Click "BMF_BETC"
	TypeText betcBMF	
end bmf_accounting_line_dimensions

// Printing Information Part
to bmf_accounting_line_information textCodeBMF
	repeat until ImageFound(ImageName: "BMF_TextCode")
		ScrollWheelDown
	end repeat
	Click "BMF_TextCode"
	TypeText textCodeBMF
end bmf_accounting_line_information

// DMS Debt Information Part
to bmf_accounting_line_dms trorBMF
	repeat until ImageFound(ImageName: "BMF_TROR")
		ScrollWheelDown
	end repeat
	Click "BMF_TROR"
	TypeText trorBMF
end bmf_accounting_line_dms

// Interagency Transfer Part
to bmf_accounting_line_transfer shortKeyBMF, custBetcBMF, quantBMF, unitBMF, ginvBMF, custFundBMF, transContactBMF, phoneNoBMF, emailBMF, subCatBMF

	// Section 1
	repeat until ImageFound(ImageName: "BMF_ShortKeyTr")
		ScrollWheelDown
	end repeat
	Click "BMF_ShortKeyTr"
	TypeText shortKeyBMF
	
	
	repeat until ImageFound(ImageName: "BMF_CustomerBETC")
		ScrollWheelDown
	end repeat
	Click "BMF_CustomerBETC"
	TypeText custBetcBMF
	ScrollWheelDown 3
	
	repeat until ImageFound(ImageName: "BMF_Quantity")
		ScrollWheelDown
	end repeat
	Click "BMF_Quantity"
	TypeText ControlKey, "a"
	TypeText quantBMF
	Click "BMF_UnitPrice"
	TypeText ControlKey, "a"
	TypeText unitBMF
	
	
	// Section 2
	Click "BMF_GlnvIPAC"
	TypeText ginvBMF
	repeat until ImageFound(ImageName: "BMF_CustFundSource")
		ScrollWheelDown
	end repeat
	Click "BMF_CustFundSource"
	TypeText custFundBMF
	Click "BMF_FundingAuthSource"
	Click "BMF_FundAuthNone"
	repeat until ImageFound(ImageName: "BMF_TransactionContact")
		ScrollWheelDown
	end repeat
	Click "BMF_TransactionContact"
	TypeText transContactBMF
	Click "BMF_ContactPhoneNumber"
	TypeText phoneNoBMF
	Click "BMF_ContactEmail"
	TypeText emailBMF
	Click "BMF_SubCategory"
	TypeText subCatBMF
	TypeText returnKey
	
end bmf_accounting_line_transfer

// User Defined Fields Part
to bmf_accounting_line_user costBMF
	repeat until ImageFound(ImageName: "BMF_FMSCostCenter")
		ScrollWheelDown
	end repeat
	Click "BMF_FMSCostCenter"
	TypeText costBMF
end bmf_accounting_line_user

// Description Part
to bmf_accounting_line_description descBMF, extDescBMF
	repeat until ImageFound(ImageName: "BMF_AL_Description")
		ScrollWheelDown
	end repeat
	Click "BMF_AL_Description"
	TypeText descBMF
	Click "BMF_ExtDescription"
	TypeText extDescBMF
end bmf_accounting_line_description

// Save & Verify Form
to bmf_save_verify
	Click "Save"
	Click "VerifyForm"
	wait 5
end bmf_save_verify

// Overriding the Errors & Submitting
to bmf_clear_errors_submitting
	Click "BMF_ErrorWarning"
	Click "BMF_OverrideWarnings"
	Click {Image:"BudgetSetup_SubmitButton", WaitFor:5}
end bmf_clear_errors_submitting



// Verfying the Document Status
to form_doc_bmf docTypeBMF, docStatus
	Click {Image:"Transactions1", WaitFor:10}
	Click {Image:"FormDocumentSelection", WaitFor:10}
	Click "CNL_DocType"
	TypeText docTypeBMF
	Click "Search_DocNum"
	TypeText ControlKey & "v" // Pasting the previously copied Doc Number in step 7!
	Click "Search"
	// I want to go down the top bottom of the page until I see Document status column to verify the status
	repeat
		ScrollWheelDown 
		Wait 0.5 //Waiting for page to load
		if ImageFound("BMF_DocumentStatus") then
			DoubleClick "BMF_DocumentStatus"
			Click "BMF_DocumentStatus"
			TypeText ControlKey, "c"
			put RemoteClipboard() into docStatus
			log docStatus
			return docStatus
		end if
	end repeat
end form_doc_bmf

(***** END of Hakan's Functions *****)


Now, I’m going to update you on the latest events. I have completely finished TBA 14. For the new functions, I tried to reuse as much as possible. If I ended up developing the same function again for the same purpose, I apologize. You will see it in the Common Functionalities section; I have only commented out the new functions I added, meaning I placed them between comments. If in the future we decide that these haven’t been reused and we need to optimize them, we can easily remove the redundant methods I’ve used by mistake.

Additionally, Test Case 14 can run smoothly from start to finish without any issues. However, for TBA 15, or TBA 15T, when we search for the document number that has the “pending approval” status we created in TBA 14, we can’t see it. This is happening on the Inbox and Links page. The reason we can’t see it, Jacob mentioned in today’s meeting, is possibly due to an authorization process or another correction that needs to be made in Agility. After this meeting, Karan discussed this issue with Scott, and Scott will ensure that we receive the correct data information that we put in the sheet. Most likely, we will have to correct TBA 14 again with the new data. Because the template number we entered according to the Test Case in TBA 14 is wrong. Jacob informed us of this. If the correct template number is entered in TBA 14, then the issues in TBA 15 and 16 will resolve themselves.

As of today, I have pushed the scripts with the incorrectly entered template to my local branch. You can check the latest version from here on GitHub. Additionally, in the 15th test step, TBA 14 and my first and last names will be written in the title section. I have automated up to this point because after clicking search, due to the issue I mentioned, we are encountering a “no results” outcome. Therefore, unfortunately, 15 and 16 cannot be automated at the moment.

Other than that, please let me know in detail tomorrow how I can assist you with TBA 10. Which test case would you like me to start with? Let’s discuss that. Or, if there’s another test case outside of TBA 10 that you want me to automate, I am here to help you with that. Thank you very much.


